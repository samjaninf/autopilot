#!/bin/sh
log() {
    echo "[INFO] $1"
}

generate() {
    SOURCE_FILE=$1
    DEST_FILE=$2
    
    cat $SOURCE_FILE | perl -p -e 's/\$\{([^}]+)\}/defined $ENV{$1} ? $ENV{$1} : $&/eg' > $DEST_FILE
}

log "Generating configuration files..."
sed -e "s~{ALERTMANAGER_SLACK_WEBHOOK}~${ALERTMANAGER_SLACK_WEBHOOK}~" /autopilot/conf/alertmanager.yml > /etc/alertmanager/alertmanager.yml

exec "$@"